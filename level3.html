<!doctype html>
<html lang="th">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>‡∏î‡πà‡∏≤‡∏ô 3/3 ‚Äî ‡∏•‡πá‡∏≠‡∏Å 5 ‡∏´‡∏•‡∏±‡∏Å (‡∏ò‡∏µ‡∏°‡∏ô‡∏±‡∏Å‡∏™‡∏∑‡∏ö)</title>
  <style>
    :root{
      --ok:#16a34a; --bad:#dc2626; --neutral:#cbd5e1;
      --fg:#0f172a; --bg:#f8fafc; --card:#ffffff; --brand:#1d4ed8;
    }
    html,body{height:100%}
    body{
      margin:0;background:var(--bg);color:var(--fg);
      font-family:system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,"Noto Sans Thai",sans-serif;
      display:grid;place-items:center;padding:16px;overflow-x:hidden;
    }
    .wrap{
      background:var(--card); width:min(860px,94vw);
      border-radius:22px; box-shadow:0 14px 34px rgb(2 6 23 / .10);
      padding:26px 22px; position:relative;
    }
    h1{margin:0 0 6px 0; font-size:clamp(20px,3.8vw,30px)}
    .lead{margin:4px 0 14px 0; color:#334155}
    .stepper{display:flex; gap:8px; margin:8px 0 14px 0;}
    .dot{width:12px; height:12px; border-radius:999px; background:#e2e8f0; opacity:.9;}
    .dot.on{background:var(--brand)}
    .grid{display:grid; grid-template-columns:repeat(5,1fr); gap:12px; margin:12px 0 4px}
    .digit{
      text-align:center; font-size:clamp(22px,6vw,40px);
      padding:16px 0; border:2.5px solid var(--neutral); border-radius:16px;
      outline:none; background:#fff; transition:border-color .15s, box-shadow .15s;
      width:100%;
    }
    .digit:focus{box-shadow:0 0 0 4px rgb(59 130 246 / .15)}
    .digit.ok{border-color:var(--ok)}
    .digit.bad{border-color:var(--bad)}
    .labels{display:grid; grid-template-columns:repeat(5,1fr); gap:12px; margin:0 0 8px}
    .label{text-align:center; font-size:12px; color:#475569}
    .msg{min-height:24px; margin-top:6px; font-size:clamp(14px,2.8vw,16px)}
    .msg.ok{color:var(--ok)} .msg.bad{color:var(--bad)}
    .row{display:flex; gap:10px; flex-wrap:wrap; margin-top:12px}
    button,a.btn{
      border:0; border-radius:12px; padding:12px 16px; font-size:16px;
      cursor:pointer; transition:filter .15s; text-decoration:none; display:inline-flex; align-items:center;
    }
    .primary{background:var(--brand); color:#fff}
    .ghost{background:#e2e8f0; color:#0f172a}
    button:disabled{filter:grayscale(.6); opacity:.7; cursor:not-allowed}
    .hint{color:#475569; font-size:14px; margin-top:8px}
    .footer{margin-top:16px; color:#64748b; font-size:12px}
    .hidden{display:none}

    /* Victory overlay (only used on stage 3) */
    .overlay{
      position:fixed; inset:0; display:none; place-items:center;
      background:linear-gradient(180deg, rgba(255,255,255,.95), rgba(248,250,252,.98));
      z-index:50;
    }
    .overlay.on{display:grid}
    .card{background:#fff; border-radius:26px; box-shadow:0 16px 38px rgb(2 6 23 / .15);
      padding:28px 24px; width:min(760px,92vw); text-align:center;}
    .title{font-size:clamp(24px,4.5vw,36px); margin:0 0 6px}
    .subtitle{color:#334155; margin:0 0 18px}
    .confetti{position:fixed; inset:0; pointer-events:none; z-index:40}
  </style>
</head>
<body>
  <canvas id="confetti" class="confetti"></canvas>
  <main class="wrap" role="main" aria-labelledby="title">
    <div class="stepper" aria-label="‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Ñ‡∏∑‡∏ö‡∏´‡∏ô‡πâ‡∏≤ 3 ‡∏î‡πà‡∏≤‡∏ô">
      <div class="dot on"></div>
      <div class="dot on"></div>
      <div class="dot on"></div>
    </div>

    <h1 id="title">‡πÉ‡∏™‡πà‡∏£‡∏´‡∏±‡∏™ 5 ‡∏´‡∏•‡∏±‡∏Å ‚Äî ‡∏î‡πà‡∏≤‡∏ô <span id="stageText">3</span>/3</h1>
    <p class="lead" id="lead">
      ‡πÅ‡∏ï‡πà‡∏•‡∏∞‡∏´‡∏•‡∏±‡∏Å‡∏°‡∏≤‡∏à‡∏≤‡∏Å <strong>‡∏ú‡∏•‡∏£‡∏ß‡∏°‡∏Ñ‡∏≥‡∏ï‡∏≠‡∏ö‡∏Ç‡∏≠‡∏á‡πÅ‡∏ï‡πà‡∏•‡∏∞‡∏Å‡∏•‡∏∏‡πà‡∏°‡∏ô‡∏±‡∏Å‡∏™‡∏∑‡∏ö</strong> ‚Äî
      <strong>‡∏´‡∏•‡∏±‡∏Å‡∏Ñ‡∏µ‡πà</strong>: <span id="ruleOddTxt">‡∏ô‡∏±‡∏ö &quot;‡∏Ç‡∏≠‡∏á‡∏õ‡∏•‡∏≠‡∏°&quot;</span> ‚Ä¢
      <strong>‡∏´‡∏•‡∏±‡∏Å‡∏Ñ‡∏π‡πà</strong>: <span id="ruleEvenTxt">‡∏ô‡∏±‡∏ö &quot;‡∏Ç‡∏≠‡∏á‡∏à‡∏£‡∏¥‡∏á&quot;</span>
      (‡∏õ‡∏£‡∏±‡∏ö‡πÑ‡∏î‡πâ‡πÉ‡∏ô‡∏•‡∏¥‡∏á‡∏Å‡πå‡∏î‡πâ‡∏ß‡∏¢‡∏û‡∏≤‡∏£‡∏≤‡∏°‡∏¥‡πÄ‡∏ï‡∏≠‡∏£‡πå <code>?odd=...&amp;even=...</code>)
    </p>

    <div class="grid" id="grid" aria-label="‡∏Å‡∏•‡πà‡∏≠‡∏á‡∏£‡∏´‡∏±‡∏™ 5 ‡∏´‡∏•‡∏±‡∏Å">
      <input class="digit" aria-label="‡∏´‡∏•‡∏±‡∏Å‡∏ó‡∏µ‡πà 1" inputmode="numeric" pattern="[0-9]*" maxlength="1" autocomplete="one-time-code">
      <input class="digit" aria-label="‡∏´‡∏•‡∏±‡∏Å‡∏ó‡∏µ‡πà 2" inputmode="numeric" pattern="[0-9]*" maxlength="1">
      <input class="digit" aria-label="‡∏´‡∏•‡∏±‡∏Å‡∏ó‡∏µ‡πà 3" inputmode="numeric" pattern="[0-9]*" maxlength="1">
      <input class="digit" aria-label="‡∏´‡∏•‡∏±‡∏Å‡∏ó‡∏µ‡πà 4" inputmode="numeric" pattern="[0-9]*" maxlength="1">
      <input class="digit" aria-label="‡∏´‡∏•‡∏±‡∏Å‡∏ó‡∏µ‡πà 5" inputmode="numeric" pattern="[0-9]*" maxlength="1">
    </div>

    <div class="labels">
      <div class="label" id="g1">‡∏Å‡∏•‡∏∏‡πà‡∏°‡∏ô‡∏±‡∏Å‡∏™‡∏∑‡∏ö‡∏≠‡∏≠‡∏ô‡πÑ‡∏•‡∏ô‡πå</div>
      <div class="label" id="g2">‡πÅ‡∏¢‡∏Å‡∏Ç‡πà‡∏≤‡∏ß‡∏à‡∏£‡∏¥‡∏á/‡∏Ç‡πà‡∏≤‡∏ß‡∏õ‡∏•‡∏≠‡∏°</div>
      <div class="label" id="g3">‡∏à‡∏≥‡πÅ‡∏ô‡∏Å‡∏£‡∏π‡∏õ AI/‡∏£‡∏π‡∏õ‡∏à‡∏£‡∏¥‡∏á</div>
      <div class="label" id="g4">‡∏à‡∏±‡∏ö‡∏™‡πÅ‡∏õ‡∏°‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°</div>
      <div class="label" id="g5">‡∏ï‡πà‡∏≠‡∏ï‡πâ‡∏≤‡∏ô‡∏™‡πÅ‡∏Å‡∏°/‡∏ü‡∏¥‡∏ä‡∏ä‡∏¥‡∏á</div>
    </div>

    <div id="msg" class="msg" aria-live="polite"></div>

    <div class="row">
      <button id="btnCheck" class="primary">‡∏ï‡∏£‡∏ß‡∏à‡∏£‡∏´‡∏±‡∏™</button>
      <button id="btnReset" class="ghost">‡∏•‡πâ‡∏≤‡∏á‡∏ä‡πà‡∏≠‡∏á</button>
      <a id="nextLink" class="ghost hidden btn" href="#">‡πÑ‡∏õ‡∏î‡πà‡∏≤‡∏ô‡∏ñ‡∏±‡∏î‡πÑ‡∏õ ‚ûú</a>
    </div>

    <div class="hint">
      ‡πÄ‡∏Ñ‡∏•‡πá‡∏î‡∏•‡∏±‡∏ö: ‡∏ß‡∏≤‡∏á (Paste) 5 ‡∏´‡∏•‡∏±‡∏Å‡πÑ‡∏î‡πâ ‚Ä¢ Backspace ‡∏¢‡πâ‡∏≠‡∏ô‡∏ä‡πà‡∏≠‡∏á ‚Ä¢ ‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡∏ú‡πà‡∏≤‡∏ô‡∏û‡∏≤‡∏£‡∏≤‡∏°‡∏¥‡πÄ‡∏ï‡∏≠‡∏£‡πå <code>?code=12345</code> ‡∏´‡∏£‡∏∑‡∏≠‡∏ó‡∏µ‡∏•‡∏∞‡∏´‡∏•‡∏±‡∏Å <code>?d1=1&amp;d2=2...</code> ‚Ä¢ ‡∏ï‡∏±‡πâ‡∏á‡∏ä‡∏∑‡πà‡∏≠‡∏Å‡∏•‡∏∏‡πà‡∏° <code>?g1=...</code> ‡∏ñ‡∏∂‡∏á <code>?g5=...</code>
    </div>
    <div class="footer">‡∏ò‡∏µ‡∏°‡∏ô‡∏±‡∏Å‡∏™‡∏∑‡∏ö ‚Ä¢ ‡∏õ‡∏•‡∏≠‡∏î‡∏†‡∏±‡∏¢: ‡∏ï‡∏£‡∏ß‡∏à‡πÉ‡∏ô‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á (‡πÑ‡∏°‡πà‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏≠‡∏≠‡∏Å)</div>
  </main>

  
  <section id="overlay" class="overlay" aria-hidden="true">
    <div class="card">
      <h2 class="title">üéâ ‡∏ä‡∏ô‡∏∞! ‡πÄ‡∏Ñ‡∏•‡∏µ‡∏¢‡∏£‡πå‡∏Ñ‡∏£‡∏ö‡∏ó‡∏±‡πâ‡∏á 3 ‡∏î‡πà‡∏≤‡∏ô</h2>
      <p class="subtitle">‡∏¢‡∏≠‡∏î‡πÄ‡∏¢‡∏µ‡πà‡∏¢‡∏°‡∏°‡∏≤‡∏Å ‡∏ó‡∏µ‡∏°‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì‡∏õ‡∏•‡∏î‡∏•‡πá‡∏≠‡∏Å‡∏ó‡∏∏‡∏Å‡∏´‡∏•‡∏±‡∏Å‡πÑ‡∏î‡πâ‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á</p>
      <div class="row" style="justify-content:center">
        <button class="ghost" onclick="location.reload()">‡πÄ‡∏•‡πà‡∏ô‡∏î‡πà‡∏≤‡∏ô‡∏ô‡∏µ‡πâ‡πÉ‡∏´‡∏°‡πà</button>
      </div>
    </div>
  </section>

  <script>
    // ===== CONFIG (‡∏Ñ‡πà‡∏≤‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏ú‡πà‡∏≤‡∏ô URL ‡πÑ‡∏î‡πâ) =====================
    const STAGE = 3;
    let SECRET_CODE = "48126";   // set via ?code=xxxxx ‡∏´‡∏£‡∏∑‡∏≠ ?d1..d5
    const NEXT_URL = null;          // ‡∏ñ‡πâ‡∏≤ null = ‡πÑ‡∏°‡πà redirect ‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥
    const AUTO_REDIRECT_MS = 1200;        // 0 ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏õ‡∏¥‡∏î‡∏≠‡∏≠‡πÇ‡∏ï‡πâ
    const DEFAULT_GROUPS = [
      "‡∏Å‡∏•‡∏∏‡πà‡∏°‡∏ô‡∏±‡∏Å‡∏™‡∏∑‡∏ö‡∏≠‡∏≠‡∏ô‡πÑ‡∏•‡∏ô‡πå",
      "‡πÅ‡∏¢‡∏Å‡∏Ç‡πà‡∏≤‡∏ß‡∏à‡∏£‡∏¥‡∏á/‡∏Ç‡πà‡∏≤‡∏ß‡∏õ‡∏•‡∏≠‡∏°",
      "‡∏à‡∏≥‡πÅ‡∏ô‡∏Å‡∏£‡∏π‡∏õ AI/‡∏£‡∏π‡∏õ‡∏à‡∏£‡∏¥‡∏á",
      "‡∏à‡∏±‡∏ö‡∏™‡πÅ‡∏õ‡∏°‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°",
      "‡∏ï‡πà‡∏≠‡∏ï‡πâ‡∏≤‡∏ô‡∏™‡πÅ‡∏Å‡∏°/‡∏ü‡∏¥‡∏ä‡∏ä‡∏¥‡∏á"
    ];
    // ‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Å‡∏ï‡∏¥‡∏Å‡∏≤ (‡∏õ‡∏£‡∏±‡∏ö‡πÑ‡∏î‡πâ‡∏ú‡πà‡∏≤‡∏ô ?odd=... & ?even=...)
    let RULE_ODD_TEXT  = "‡∏ô‡∏±‡∏ö \\\"‡∏Ç‡∏≠‡∏á‡∏õ‡∏•‡∏≠‡∏°\\\"";
    let RULE_EVEN_TEXT = "‡∏ô‡∏±‡∏ö \\\"‡∏Ç‡∏≠‡∏á‡∏à‡∏£‡∏¥‡∏á\\\"";
    // ======================================================================

    // ‡∏≠‡πà‡∏≤‡∏ô‡∏Ñ‡πà‡∏≤‡∏à‡∏≤‡∏Å URL
    try {
      const q = new URLSearchParams(location.search);
      // code
      const code = q.get("code");
      const d1=q.get("d1"), d2=q.get("d2"), d3=q.get("d3"), d4=q.get("d4"), d5=q.get("d5");
      const next = q.get("next");
      const odd  = q.get("odd");
      const even = q.get("even");

      if (odd)  document.getElementById("ruleOddTxt").textContent  = odd;
      if (even) document.getElementById("ruleEvenTxt").textContent = even;

      if (code && /^\\d{5}$/.test(code)) SECRET_CODE = code;
      else if ([d1,d2,d3,d4,d5].every(x => /^\\d$/.test(x||""))) SECRET_CODE = `${d1}{d2}{d3}{d4}{d5}`;

      if (next) window.NEXT_URL_OVERRIDE = next;

      // groups
      for (let i=1;i<=5;i++) {
        const g = q.get("g"+i);
        if (g) document.getElementById("g"+i).textContent = g;
      }
    } catch(e) {}

    // DOM
    const inputs = Array.from(document.querySelectorAll(".digit"));
    const msgEl = document.getElementById("msg");
    const btnCheck = document.getElementById("btnCheck");
    const btnReset = document.getElementById("btnReset");
    const nextLink = document.getElementById("nextLink");

    function digits() { return inputs.map(i => (i.value || "").trim()); }
    function allFilled() { return digits().every(d => d !== ""); }
    function validatePerDigit(){
      const val = digits();
      return val.map((d,i) => d === SECRET_CODE[i]);
    }

    function applyStyles(){
      const res = validatePerDigit();
      inputs.forEach((inp,i)=>{
        inp.classList.remove("ok","bad");
        if (inp.value === "") return;
        inp.classList.add(res[i] ? "ok" : "bad");
      });

      if (!allFilled()){
        msgEl.textContent = "";
        msgEl.className = "msg";
        nextLink.classList.add("hidden");
        return;
      }

      const wrongIdx = res.map((v,i)=> v?null:i+1).filter(Boolean);
      if (wrongIdx.length === 0){
        msgEl.textContent = "‚úÖ ‡∏£‡∏´‡∏±‡∏™‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á ‚Äî ‡∏ú‡πà‡∏≤‡∏ô‡∏î‡πà‡∏≤‡∏ô " + STAGE + "/3";
        msgEl.className = "msg ok";

        inputs.forEach(i=> i.setAttribute("disabled","true"));
        btnCheck.setAttribute("disabled","true");

        // ‡∏î‡πà‡∏≤‡∏ô‡∏™‡∏∏‡∏î‡∏ó‡πâ‡∏≤‡∏¢‡∏°‡∏µ‡∏´‡∏ô‡πâ‡∏≤‡∏ä‡∏±‡∏¢‡∏ä‡∏ô‡∏∞ (‡πÄ‡∏â‡∏û‡∏≤‡∏∞ stage 3)
        if (true) {
          showVictory();
        } else {
          const url = (typeof window.NEXT_URL_OVERRIDE === "string") ? window.NEXT_URL_OVERRIDE : null;
          if (url){
            if (AUTO_REDIRECT_MS > 0) setTimeout(()=> location.href = url, AUTO_REDIRECT_MS);
            else {
              nextLink.href = url; nextLink.classList.remove("hidden");
              nextLink.textContent = "‡πÑ‡∏õ‡∏î‡πà‡∏≤‡∏ô‡∏ñ‡∏±‡∏î‡πÑ‡∏õ ‚ûú";
            }
          }
        }
      } else {
        msgEl.textContent = "‚ùå ‡∏£‡∏´‡∏±‡∏™‡∏ú‡∏¥‡∏î ‚Äî ‡∏ú‡∏¥‡∏î‡∏ó‡∏µ‡πà‡∏´‡∏•‡∏±‡∏Å: " + wrongIdx.join(", ");
        msgEl.className = "msg bad";
        nextLink.classList.add("hidden");
      }
    }

    function resetInputs(){
      inputs.forEach(i=>{ i.removeAttribute("disabled"); i.value=""; i.classList.remove("ok","bad"); });
      btnCheck.removeAttribute("disabled");
      msgEl.textContent=""; msgEl.className="msg";
      nextLink.classList.add("hidden");
      inputs[0].focus();
    }

    // Events
    inputs.forEach((inp, idx)=>{
      inp.addEventListener("input", ()=>{
        let v = inp.value.replace(/\\D/g,""); if (v.length > 1) v = v.slice(-1); inp.value = v;
        if (v && idx < inputs.length - 1){ inputs[idx+1].focus(); inputs[idx+1].select?.(); }
        applyStyles();
      });
      inp.addEventListener("keydown", (e)=>{
        if (e.key === "Backspace" && !inp.value && idx > 0){
          inputs[idx-1].focus(); inputs[idx-1].value = ""; inputs[idx-1].dispatchEvent(new Event("input")); e.preventDefault();
        }
        if (e.key === "ArrowLeft" && idx > 0){ inputs[idx-1].focus(); e.preventDefault(); }
        if (e.key === "ArrowRight" && idx < inputs.length - 1){ inputs[idx+1].focus(); e.preventDefault(); }
      });
      inp.addEventListener("paste", (e)=>{
        const text = (e.clipboardData || window.clipboardData).getData("text");
        const m = text.match(/\\d/g); if (!m) return; e.preventDefault();
        const nums = m.slice(0,5); for (let i=0;i<nums.length;i++) inputs[i].value = nums[i];
        (nums.length < 5 ? inputs[nums.length] : inputs[4]).focus();
        applyStyles();
      });
    });
    btnCheck.addEventListener("click", applyStyles);
    btnReset.addEventListener("click", resetInputs);

    // ===== Victory (‡πÄ‡∏â‡∏û‡∏≤‡∏∞ stage 3) =====
    
    let ctx=null, confettiCanvas=null, confettiPieces=[], confettiTimer=null, rafId=null, started=false;
    function showVictory(){
      // overlay on
      const overlay = document.getElementById("overlay");
      overlay.classList.add("on"); overlay.setAttribute("aria-hidden","false");
      // confetti
      if (!started){
        confettiCanvas = document.getElementById("confetti");
        ctx = confettiCanvas.getContext("2d");
        function resize(){ confettiCanvas.width = innerWidth; confettiCanvas.height = innerHeight; }
        addEventListener("resize", resize); resize();
        startConfetti(4500); started = true;
      } else { startConfetti(4500); }
    }
    function startConfetti(durationMs=4000){
      confettiPieces = Array.from({length: 180}, ()=> ({
        x: Math.random()*confettiCanvas.width,
        y: Math.random()*-confettiCanvas.height,
        s: 5+Math.random()*8,
        v: 2+Math.random()*3,
        a: Math.random()*Math.PI*2,
        w: 0.02+Math.random()*0.06
      }));
      const t0 = performance.now();
      function draw(now){
        ctx.clearRect(0,0,confettiCanvas.width,confettiCanvas.height);
        confettiPieces.forEach(p=>{
          p.y += p.v; p.x += Math.sin(p.a)*0.8; p.a += p.w;
          if (p.y > confettiCanvas.height+20){ p.y = -10; p.x = Math.random()*confettiCanvas.width; }
          ctx.save(); ctx.translate(p.x, p.y); ctx.rotate(p.a);
          ctx.fillStyle = ["#ef4444","#f59e0b","#10b981","#3b82f6","#a855f7"][Math.floor(Math.random()*5)];
          ctx.fillRect(-p.s/2, -p.s/2, p.s, p.s*1.2);
          ctx.restore();
        });
        if (now - t0 < durationMs) rafId = requestAnimationFrame(draw);
      }
      rafId = requestAnimationFrame(draw);
      confettiTimer = setTimeout(stopConfetti, durationMs+200);
    }
    function stopConfetti(){
      if (rafId) cancelAnimationFrame(rafId);
      if (confettiTimer) clearTimeout(confettiTimer);
      if (ctx) ctx.clearRect(0,0,confettiCanvas.width,confettiCanvas.height);
    }
    
  </script>
</body>
</html>
